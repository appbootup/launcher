version: '3.5'

services:
  cleaner:
    container_name: mitra-cleaner-${MACHINE_ID:-M001}
    image: nsubrahm/machine-cleaner:${CLEANER_TAG:-v0.0.0}
    env_file:
      - cleaner.env
    ports:
      - "8080:8080"
    healthcheck:
      test: wget --no-verbose --tries=1 http://localhost:8080/health || exit 1
      interval: 10s
      timeout: 2s
      retries: 3
      start_period: 10s
    networks:
      - kafkastreams-network

  alarms:
    container_name: mitra-alarms-${MACHINE_ID:-M001}
    image: nsubrahm/machine-alarms:${ALARMS_TAG:-v0.0.0}
    env_file:
      - alarms.env
    networks:
      - kafkastreams-network

  alerts:
    container_name: mitra-alerts-${MACHINE_ID:-M001}
    image: nsubrahm/machine-alerts:${ALERTS_TAG:-v0.0.0}
    env_file:
      - alerts.env
    networks:
      - kafkastreams-network

  merger:
    container_name: mitra-merger-${MACHINE_ID:-M001}
    image: nsubrahm/machine-merger:${MERGER_TAG:-v0.0.0}
    env_file:
      - merger.env
    networks:
      - kafkastreams-network

  streamer:
    container_name: mitra-streamer-${MACHINE_ID:-M001}
    image: nsubrahm/machine-streamer:${STREAMER_TAG:-v0.0.0}
    env_file:
      - streamer.env
    ports:
      - "8080:8080"
    networks:
      - kafkastreams-network

networks:
  kafkastreams-network:
    name: ks
